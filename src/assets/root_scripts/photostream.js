var excludeMobileRedirect = ["/fifaworldcup/organisation/ticketing/", "/worldcup/organisation/ticketing/"];define(['lang=en/slider'],function () {;(function($,w,d) {var photostreamModel=fifa.model.extend({photoChanges:0,changesBeforeAdv:-1,totalPhotos:-1,photoIndex:1,contentId:-1,$thumbs:null,thumbs:[],thumbMap:{},grid:null,gridItemBase:null,initialize:function(options) {var _this=this;fifa.model.prototype.initialize.apply(this,[options]);_this.$thumbs=$('.ph-str-thumbs-wrapper .ph-str-thumb');var _onHashChange=function(e) {if(w.disable_hashchange_evt) {return;}_this.setPhotoFromHash();};$(w).bind('hashchange',_onHashChange);},onInit:function(totalPhotos,adv) {var _this=this;_this.photoChanges=0;_this.changesBeforeAdv=adv ? 5:Infinity;_this.totalPhotos=totalPhotos;_this.photoIndex=1;_this.setPhotoFromHash(true);},onDestroy:function(){this.thumbs=[];},onForceDisableAdv:function() {this.changesBeforeAdv=Infinity;},setPhotoFromHash:function(checkHash) {var _this=this,hash=w.location.hash,photoIndex=1,photoId=-1;if(checkHash&&!hash) { return;}if(hash) {photoId=hash.substr(1);if(isNaN(photoId)) { return;}photoIndex=photoId ? _this.$thumbs.filter('[ph-data-picture-id=' + photoId + ']').index() + 1:-1;}if(photoIndex>-1&&_this.photoIndex!==photoIndex) {_this.photoIndex=photoIndex;_this.photoChanges--;var disabletracking=!(photoId!=-1&&photoId!=_this.contentId);_this.triggerMe('setPhoto',_this.photoIndex,disabletracking);}_this.triggerMe('hashSet');},onHideAdv:function() {this.photoChanges=0;},onSetPhoto:function(index,disabletracking) {var _this=this;if(_this.photoChanges<_this.changesBeforeAdv) {_this.photoIndex=index||_this.photoIndex;_this.triggerView('showPhotoPrev',_this.photoIndex>1);_this.triggerView('showPhotoNext',_this.photoIndex<_this.totalPhotos);if(w.currentPlatform!='mobile'&&(++_this.photoChanges)>=_this.changesBeforeAdv) {_this.triggerMe('showAdv');}_this.triggerView('setCurrentPhoto',_this.photoIndex,disabletracking);}},onNextPhoto:function(index) {var _this=this;if(_this.photoIndex<_this.totalPhotos) {var i=parseInt(_this.photoIndex) + 1;_this.triggerMe('setPhoto',i);}},onPrevPhoto:function(index) {var _this=this;if(_this.photoIndex>1) {var i=parseInt(_this.photoIndex) - 1;_this.triggerMe('setPhoto',i);}},onHashChange:function(id) {w.disable_hashchange_evt=true;this.contentId=id;if(this.$thumbs.filter('[ph-data-picture-id=' + id + ']').index()===0) {w.location.hash='';}else {w.location.hash='#' + id;}w.disable_hashchange_evt=false;},onGridInit:function(wrap) {var _this=this;_this.photoChanges--;$.each(_this.$thumbs,function() {var obj={};obj.orientation=$(this).attr('ph-data-picture-orientation');obj.lnd=$(this).attr('ph-data-picture-url');obj.full=$(this).attr('ph-data-picture-url-full');obj.grid=$(this).attr('ph-data-picture-url-grid');obj.id=$(this).attr('ph-data-picture-id');obj.copyright=$(this).attr('ph-data-picture-copyright');obj.title=$(this).attr('ph-data-picture-title');obj.date=$(this).attr('ph-data-picture-date');obj.comment=$(this).attr('ph-data-picture-comment');_this.thumbs.push(obj);_this.thumbMap[obj.id]=_this.thumbs.length;});_this.grid=wrap;_this.gridItemBase=$(_this.grid).find(".grid-item");$(_this.grid).find(".grid-item").remove();},onLoadGridView:function() {var _this=this;var _ul=$(_this.grid).find("ul");if($(_ul).find("li").length===0) {_this.thumbs.forEach(function(thumb) {$(_ul).append(_this.newGridThumb(thumb));});}},newGridThumb:function(thumb) {var _this=this,_newItem=_this.gridItemBase.clone(),$img=$(_newItem).find("img");$img.attr("src",thumb.grid);$img.attr("data-picture-id",thumb.id);$img.attr("data-photo-size",thumb.orientation==='portrait' ? 'sqr-3':'lnd-3');$img.addClass(thumb.orientation);$(_newItem).click(function(e) {e.preventDefault();if(_this.photoIndex!==_this.thumbMap[thumb.id]) {w.location.hash=thumb.id;_this.photoChanges++;}_this.triggerView("selectFullView");});return _newItem;},name:'photostream',view_name:'photostream:view'});w.models.photostream=new photostreamModel({bind:['init','setPhoto','nextPhoto','prevPhoto','hideAdv','hashChange','forceDisableAdv','loadGridView','gridInit','destroy']});}(window.jQuery||window.jm,window,document));;(function($,w,d) {var photostreamView=fifa.view.extend({$selectedWrapper:null,$arrow_prev:null,$arrow_next:null,arrow_height:0,$selected:null,$selectedImage:null,$copyright:null,$title:null,$comment:null,$date:null,Image:null,$currentText:null,$adv:null,$close_btn:null,$full_btn:null,$play_btn:null,$pause_btn:null,$grid_btn:null,$full_gallery_wrap:null,$full_gallery_header:null,$full_gallery_under:null,$full_gallery_adv:null,$full_gallery_selected:null,$full_gallery_selected_image:null,$full_gallery_next:null,$full_gallery_prev:null,$full_gallery_copyright:null,$full_gallery_title:null,$full_gallery_comment:null,$full_gallery_date:null,$full_gallery_currentText:null,$page_content_wrap:null,$full_wrap:null,$grid_wrap:null,viewMode:'full',keepPlay:false,slideFrequencyMS:5000,initialize:function(options) {var _this=this;fifa.view.prototype.initialize.apply(_this,[options]);_this.$selectedWrapper=_this.$el.find('.ph-str-selected-wrapper');_this.$arrow_prev=_this.$selectedWrapper.find('.arrow-prev,.nav-prev');_this.$arrow_next=_this.$selectedWrapper.find('.arrow-next,.nav-next');_this.arrow_height=_this.$arrow_next.height();_this.$selected=_this.$selectedWrapper.find('.ph-str-selected-i');_this.$selectedImage=_this.$selected.find('>img');_this.$copyright=_this.$selectedWrapper.find('.ph-str-selected-copyright>span');_this.$title=_this.$selectedWrapper.find('.ph-str-selected-title');_this.$comment=_this.$selectedWrapper.find('.ph-str-selected-comment');_this.$date=_this.$selectedWrapper.find('.ph-str-selected-date');_this.$currentText=_this.$selectedWrapper.find('.ph-str-selected-index .current');_this.$adv=_this.$selectedWrapper.find('.adv-wrap');_this.triggerModel('init',$('.ph-str-thumbs-wrapper .ph-str-thumb').size(),$('.ph-str-wrapper .adv-wrap')[0]);},FullScreenInit:function(options) {var _this=this;_this.$full_gallery_wrap=$('.full-gallery-wrap');_this.$full_gallery_header=_this.$full_gallery_wrap.find('.header-wrap');_this.$full_gallery_header.addClass('collapsible collapsed');_this.$full_wrap=_this.$full_gallery_wrap.find('.content-wrap .full-wrap');_this.$grid_wrap=_this.$full_gallery_wrap.find('.content-wrap .grid-wrap');_this.$close_btn=_this.$full_gallery_wrap.find('.cmd-wrap .btn-close');_this.$full_btn=_this.$full_gallery_wrap.find('.cmd-wrap .btn-full');_this.$grid_btn=_this.$full_gallery_wrap.find('.cmd-wrap .btn-grid');_this.$play_btn=_this.$full_gallery_wrap.find('.cmd-wrap .btn-play');_this.$pause_btn=_this.$full_gallery_wrap.find('.cmd-wrap .btn-pause');_this.$full_gallery_adv=_this.$full_gallery_wrap.find('.adv-wrap');_this.$full_gallery_selected=_this.$full_gallery_wrap.find('.ph-str-selected-i');_this.$full_gallery_selected_image=_this.$full_gallery_selected.find('>img');_this.$full_gallery_next=_this.$full_gallery_wrap.find('.arrow-next,.nav-next');_this.$full_gallery_prev=_this.$full_gallery_wrap.find('.arrow-prev,.nav-prev');_this.$full_gallery_under=_this.$full_gallery_wrap.find('.ph-str-selected-under');_this.$full_gallery_under.addClass('collapsible collapsed');_this.$full_gallery_under.find('.ph-str-selected-expand').removeClass('hidden');_this.$full_gallery_copyright=_this.$full_gallery_under.find('.ph-str-selected-copyright>span');_this.$full_gallery_title=_this.$full_gallery_under.find('.ph-str-selected-title');_this.$full_gallery_comment=_this.$full_gallery_under.find('.ph-str-selected-comment');_this.$full_gallery_date=_this.$full_gallery_under.find('.ph-str-selected-date');_this.$full_gallery_currentText=_this.$full_gallery_under.find('.ph-str-selected-index .current');_this.$close_btn.click(function(e) { e.preventDefault(); _this.onHideFullscreenWrap();});_this.$full_btn.click(function(e) { e.preventDefault(); _this.onSelectFullView();});_this.$grid_btn.click(function(e) { e.preventDefault(); _this.onSelectGridView();});_this.$play_btn.click(function(e) { e.preventDefault(); _this.onTogglePlay();});_this.$pause_btn.click(function(e) { e.preventDefault(); _this.onTogglePlay();});_this.$full_gallery_next.click(function(e) { e.preventDefault(); _this.showNextPhoto();});_this.$full_gallery_prev.click(function(e) { e.preventDefault(); _this.showPrevPhoto();});_this.$full_gallery_adv.find('.adv-close').click(function() { _this.hideAdv();});var $full_gallery_header_title=_this.$full_gallery_header.find('.title');if($full_gallery_header_title[0].scrollHeight>$full_gallery_header_title.outerHeight()) {_this.$full_gallery_header.mouseenter(function(e) { _this.toggleCollapse(e,true);});_this.$full_gallery_header.mouseleave(function(e) { _this.toggleCollapse(e,false);});_this.$full_gallery_header.find('.btn-expand').click(function(e) { _this.toggleCollapse(e,true);});_this.$full_gallery_header.find('.btn-collapse').click(function(e) { _this.toggleCollapse(e,false);});}else {_this.$full_gallery_header.find('.btn-expand').remove();_this.$full_gallery_header.find('.btn-collapse').remove();}_this.$full_gallery_under.mouseenter(function(e) { _this.toggleCollapse(e,true);});_this.$full_gallery_under.mouseleave(function(e) { _this.toggleCollapse(e,false);});_this.$full_gallery_under.find('.btn-expand').click(function(e) { _this.toggleCollapse(e,true);});_this.$full_gallery_under.find('.btn-collapse').click(function(e) { _this.toggleCollapse(e,false);});$("body").keydown(function(e) {_this.filterOnKeyPress(e);});_this.$thumbs=_this.$el.find('.ph-str-thumbs-wrapper .ph-str-thumb');_this.triggerModel('gridInit',_this.$grid_wrap);if(!_this.$page_content_wrap) {_this.$page_content_wrap=$('#content-wrap');}fifa.dispatcher.trigger('core:reinit');_this.$page_content_wrap.hide();},selectButtons:function() {var _this=this;_this.$grid_btn.toggleClass('hidden',_this.viewMode==='grid');_this.$full_btn.toggleClass('hidden',_this.viewMode==='full');_this.$play_btn.removeClass('hidden');_this.$pause_btn.addClass('hidden');},onSelectFullView:function() {var _this=this;_this.viewMode='full';_this.$grid_wrap.addClass('hidden');_this.$full_wrap.removeClass('hidden');_this.selectButtons();},onSelectGridView:function() {var _this=this;_this.viewMode='grid';_this.$full_wrap.addClass('hidden');_this.$grid_wrap.removeClass('hidden');_this.selectButtons();_this.triggerModel('loadGridView');fifa.dispatcher.trigger('analytics:playPauseGrid','grid');_this.StopPlaying();},onTogglePlay:function() {var _this=this;if(_this.viewMode=='grid') {_this.onSelectFullView();}_this.$play_btn.toggleClass('hidden');_this.$pause_btn.toggleClass('hidden');if(_this.keepPlay) {_this.keepPlay=false;if(w.fifa.analytics.PhotoGallery) {w.fifa.analytics.PhotoGallery.autoplay=false;fifa.dispatcher.trigger('analytics:playPauseGrid','pause');}}else {_this.keepPlay=true;if(w.fifa.analytics.PhotoGallery) {w.fifa.analytics.PhotoGallery.autoplay=true;fifa.dispatcher.trigger('analytics:playPauseGrid','play');}setTimeout(_this.Play,_this.slideFrequencyMS);}},Play:function() {if(_this.keepPlay) {_this.triggerModel('nextPhoto');setTimeout(_this.Play,_this.slideFrequencyMS);}},StopPlaying:function() {_this=this;_this.keepPlay=false;if(_this.$play_btn) {_this.$play_btn.removeClass('hidden');_this.$pause_btn.addClass('hidden');}},onHideFullscreenWrap:function() {_this.$page_content_wrap.show();if(_this.$full_gallery_wrap) {_this.$full_gallery_wrap.remove();}_this.$full_gallery_wrap=null;_this.$full_wrap=null;_this.$grid_wrap=null;_this.$close_btn=null;_this.$full_btn=null;_this.$grid_btn=null;_this.$play_btn=null;_this.$pause_btn=null;_this.$full_gallery_adv=null;_this.$full_gallery_selected=null;_this.$full_gallery_selected_image=null;_this.$full_gallery_next=null;_this.$full_gallery_prev=null;_this.StopPlaying();$("body").off("keydown");_this.triggerModel('destroy');if(w.fifa.analytics.PhotoGallery) {w.fifa.analytics.PhotoGallery.fullScreenGallery=false;}},filterOnKeyPress:function(e) {if(!_this.advShown) {switch (e.keyCode) {case 39:if("ar"=="en") {_this.showPrevPhoto(e);}else {_this.showNextPhoto(e);}break;case 37:if("ar"=="en") {_this.showNextPhoto(e);}else {_this.showPrevPhoto(e);}break;case 27:_this.onHideFullscreenWrap();break;case 32:_this.onTogglePlay();break;default:break;}}},events:{'click .ph-str-selected-wrapper .nav-next':'showNextPhoto','click .ph-str-selected-wrapper .nav-prev':'showPrevPhoto','click .adv-wrap .adv-close':'hideAdv','click .fullbtn-wrap':'showFullscreenWrap','click .cmd-wrap .btn-close':'onHideFullscreenWrap','click .cmd-wrap .btn-full':'onSelectFullView','click .cmd-wrap .btn-grid':'onSelectGridView','click .cmd-wrap .btn-play':'onTogglePlay','click .cmd-wrap .btn-pause':'onTogglePlay'},set$SelectedHeight:function(height,width) {if(!fifa.is_mobile) {return;}var _this=this,screen_width=fifa.getScreenWidth();var ratio=width / height,new_height=(screen_width / ratio);screen_width=screen_width<width ? screen_width:width;if(new_height<height) {height=new_height;}if(fifa.is_mobile) {height += _this.arrow_height;}_this.$selected.height(height);},coreOnWindowResize:function() {var _this=this;if(_this.$selected) {var $img=_this.$selected.find('img'),height=$img.height(),width=$img.width();_this.set$SelectedHeight(height,width);}},getMmurl:function(mmurls,formatName) {var i,l=(mmurls||[]).length;for (i=0; i<l; i++) {var obj=mmurls[i];for (var p in obj) {if(p===formatName) {return ['//img.fifa.com','/mm',obj[p]].join('');}}}},getExternalImage:function(photoId,setPhotoCallback,disabletracking,fullscreen,params) {var _this=this,cached_key=['photos',photoId].join(''),cached_photo=fifa.cacheMap.get(cached_key),setImageCallback=function(data) {if(!data) { return;}fifa.cacheMap.set(cached_key,data);var $data=$(data);if(!$data.length) { return;}var photo_obj=$data[0],orientation=photo_obj.isLandscape==='1' ? 'landscape':'portrait',tmpl='<div class="ph-str-thumb" ph-data-picture-orientation="{{orientation}}" ph-data-picture-url="{{getBigSrc}}" ph-data-picture-index="{{index}}" ph-data-picture-id="{{wNewsID}}" ph-data-picture-copyright="{{wNewsCopyrightName}}" ph-data-picture-title="{{DisplayHeadline}}" ph-data-picture-comment="{{{DisplaySummary}}}"></div>';photo_obj.orientation=orientation;photo_obj.getBigSrc=function() {var img_src=_this.getMmurl(this.MMURLs,'MMURL_BIG-LND');if(!img_src) {img_src=_this.getMmurl(this.MMURLs,'MMURL_FULL-LND');}return img_src;};photo_obj.index=Infinity;_this.$('.ph-str-thumbs-wrapper').append(Mustache.render(tmpl,photo_obj));setPhotoCallback(Infinity,disabletracking,fullscreen,params,orientation,photoId);fifa.dispatcher.trigger('slider:view:setSelected',[]);};if(cached_photo) {setImageCallback(cached_photo);return;}if(_this.ext_xhr) { _this.ext_xhr.abort();}_this.ext_xhr=$.ajax({type:'get',url:'/_inc/photos/photo={0}.html'.format(photoId),dataType:'json',success:setImageCallback});},setPhoto:function(thumbIndex,disabletracking,fullscreen,params) {var _this=this,$thumb=_this.$('.ph-str-thumb[ph-data-picture-index=' + thumbIndex + ']'),$prev_thumb=$thumb.prev('.ph-str-thumb'),$next_thumb=$thumb.next('.ph-str-thumb'),orientation=$thumb.attr('ph-data-picture-orientation'),alt=$thumb.attr('alt'),contentId=$thumb.attr('ph-data-picture-id'),setPhotoCallback=function(thumbIndex,disabletracking,fullscreen,params,orientation,contentId,$thumb) {var img=new Image();$thumb=$thumb||_this.$('.ph-str-thumb[ph-data-picture-index=' + thumbIndex + ']');if(thumbIndex===Infinity) {params.currentText.closest('.ph-str-selected-index').addClass('hidden');params.date.addClass('hidden');_this.$('.fullbtn-wrap').addClass('hidden');}else {params.currentText.closest('.ph-str-selected-index').removeClass('hidden').end().text(thumbIndex);params.date.removeClass('hidden');_this.$('.fullbtn-wrap').removeClass('hidden');}params.selectedImage.hide().removeClass('portrait landscape').addClass(orientation).attr('alt',alt).attr('title',alt);params.selected.removeClass('portrait landscape').addClass(orientation);if(!$thumb.length) {params.selectedImage.show();}else {img.onload=function() {var height=this.height,width=this.width;if(fullscreen) {var fullsized=orientation==='landscape'&&width>=fifa.getScreenWidth();fullsized=fullsized||orientation==='portrait'&&height>=fifa.getScreenHeight();params.selectedImage.toggleClass('fullsized',fullsized);}_this.set$SelectedHeight(height,width);params.selectedImage.attr('src',img.src).show();};img.src=$thumb.attr(fullscreen ? 'ph-data-picture-url-full':'ph-data-picture-url').htmlDecode(true);}params.arrow_next.attr('title',$next_thumb.attr('ph-data-picture-title')||params.arrow_next.attr('alt'));params.arrow_prev.attr('title',$prev_thumb.attr('ph-data-picture-title')||params.arrow_prev.attr('alt'));params.copyright.text($thumb.attr('ph-data-picture-copyright'));params.title.text($thumb.attr('ph-data-picture-title'));params.comment.html($thumb.attr('ph-data-picture-comment'));params.date.text($thumb.attr('ph-data-picture-date'));if(!!contentId) {_this.triggerModel('hashChange',contentId);if(!disabletracking) {if(!!window.fifa.analytics.PhotoGallery&&!!window.fifa.analytics.PhotoGallery.fullScreenGallery) {window.fifa.analytics.PhotoGallery.fsTracked=window.fifa.analytics.PhotoGallery.fsTracked||false;window.fifa.analytics.PhotoGallery.fsToTrack=window.fifa.analytics.PhotoGallery.fsToTrack||true;if(!disabletracking&&!!_this.$full_gallery_wrap&&!!window.fifa.analytics.PhotoGallery.fullScreenGallery&&(!!window.fifa.analytics.PhotoGallery.fsTracked ^!!window.fifa.analytics.PhotoGallery.fsToTrack)) {fifa.dispatcher.trigger('analytics:photoView',contentId);window.fifa.analytics.PhotoGallery.fsTracked=true;}else {if(!!window.fifa.analytics.PhotoGallery.fsTracked&&!!window.fifa.analytics.PhotoGallery.fsToTrack) {window.fifa.analytics.PhotoGallery.fsTracked=false;}}}else {fifa.dispatcher.trigger('analytics:photoView',contentId);}}}};if(!$thumb.length) {var photoId=w.location.hash.substr(1);if(!isNaN(photoId)) {_this.getExternalImage(photoId,setPhotoCallback,disabletracking,fullscreen,params);return;}}setPhotoCallback(thumbIndex,disabletracking,fullscreen,params,orientation,contentId,$thumb);},onSetCurrentPhoto:function(thumbIndex,disabletracking) {var _this=this;_this.setPhoto(thumbIndex,disabletracking,false,{'currentText':_this.$currentText,'selectedImage':_this.$selectedImage,'selected':_this.$selected,'arrow_next':_this.$arrow_next,'arrow_prev':_this.$arrow_prev,'copyright':_this.$copyright,'title':_this.$title,'comment':_this.$comment,'date':_this.$date});if(_this.$full_gallery_wrap) {_this.setPhoto(thumbIndex,disabletracking,true,{'currentText':_this.$full_gallery_currentText,'selectedImage':_this.$full_gallery_selected_image,'selected':_this.$full_gallery_selected,'arrow_next':_this.$full_gallery_next,'arrow_prev':_this.$full_gallery_prev,'copyright':_this.$full_gallery_copyright,'title':_this.$full_gallery_title,'comment':_this.$full_gallery_comment,'date':_this.$full_gallery_date});}},onShowPhotoPrev:function(show) {this.$arrow_prev.toggleClass('disabled',!show);if(this.$full_gallery_prev) {this.$full_gallery_prev.toggleClass('disabled',!show);}},onShowPhotoNext:function(show) {this.$arrow_next.toggleClass('disabled',!show);if(this.$full_gallery_next) {this.$full_gallery_next.toggleClass('disabled',!show);}},photostreamOnShowAdv:function() {var adv=this.$full_gallery_adv ? this.$full_gallery_adv:this.$adv;fifa.dispatcher.trigger('page:view:advPhotoRefresh',adv.find('.adv-content'));adv.removeClass('hidden');this.advShown=true;},hideAdv:function() {var adv=this.$full_gallery_adv ? this.$full_gallery_adv:this.$adv;adv.addClass('hidden');this.triggerModel('hideAdv');this.advShown=false;},showNextPhoto:function(e) {this.StopPlaying();this.triggerModel('nextPhoto');},showPrevPhoto:function(e) {this.StopPlaying();this.triggerModel('prevPhoto');},showFullscreenWrap:function(e) {e.preventDefault();_this=this;var galleryContent=$(".ph-str-wrapper");var path='/_inc/galleries/fullwrap.html';if(path&&galleryContent) {$.get(path).done(function(data) {if(data.indexOf("@@gallery-content@@")) {data=data.replace("@@gallery-content@@",$(galleryContent).html());data=data.replace("@@gallery-title@@",$('.ph-str-title').text());$('body').append(data);_this.FullScreenInit();_this.triggerModel("setPhoto");}});}w.fifa.analytics.PhotoGallery={ fullScreenGallery:true};},sliderOnItemClick:function(e,idx) {this.triggerModel('setPhoto',idx);},toggleCollapse:function(e,expanded) {$target=$(e.currentTarget);if(!$target.hasClass('collapsible')) {$target=$target.closest('.collapsible');}$target.toggleClass('collapsed',!expanded);$target.find('.btn-expand').toggleClass('hidden',expanded);$target.find('.btn-collapse').toggleClass('hidden',!expanded);},name:'photostream:view',model_name:'photostream'});w.views.photostream=new photostreamView({el:'.ph-str-wrapper',bind:['setCurrentPhoto','photostream:showAdv','showPhotoPrev','showPhotoNext','slider:itemClick','core:windowResize','selectFullView']});}(window.jQuery||window.jm,window,document)); });
